_configure() {
	make ARCH=${LJOS_ARCH} CROSS_COMPILE=${LJOS_TARGET}- x86_64_defconfig
}

_make() {
	make -j${THREADS} ARCH=${LJOS_ARCH} CROSS_COMPILE=${LJOS_TARGET}-
}

_install() {
	make ARCH=${LJOS_ARCH} CROSS_COMPILE=${LJOS_TARGET}- \
	INSTALL_MOD_PATH=${LJOS} modules_install

	cp -v arch/x86/boot/bzImage ${LJOS}/boot/vmlinuz-${version}
	cp -v System.map ${LJOS}/boot/System.map-${version}
	cp -v .config ${LJOS}/boot/config-${version}

	${LJOS}/cross-tools/bin/depmod.pl \
	-F ${LJOS}/boot/System.map-${version} \
	-b ${LJOS}/lib/modules/${version}
}

build() {
	_configure
	_make
	_install
}
